
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_PHEDServeLayoutPage.cshtml";
}

<link href="~/Scripts/sweetalert2-master/dist/sweetalert.css" rel="stylesheet" />
<script src="~/Scripts/sweetalert2-master/dist/sweetalert.js"></script>

<div class="container-fluid">
    
    <p class="lead">
       National Grid Energy Monitoring & Audit
    </p>
    <hr>
    <div class="card">
        <div class="card-body">
            <form>

                <div class="form-group row">  
                    
                    <div class="col-6 col-sm-4">

                        <label for="exampleFormControlInput1">Select Reading Date</label>

                        <input type="date" data-bind="value:SelectedReadingDate" class="form-control" id="PHEDDate" />

                    </div>

                    <div class="col-6 col-sm-4">
                        <label for="exampleFormControlInput1">Transmission Station</label> 
                        <select name="MinistryAgencyff" id="MinistryAgency" class="form-control" style="width: 100%" data-bind="options: ModifiedTransmissionStationList, optionsText: 'TransmissionStationName',optionValue: 'TransmissionStationID', value: SelectedTransmissionStations,   valueUpdate:'change',optionsCaption: 'Choose', event:{'change': bindFeeders}"></select>
                    </div> 

                    <div class="col-6 col-sm-4">
                        <label for="exampleFormControlInput1">Transformer Capacity</label> 
                    
                        <select name="MinistryAgencyff" id="MinistrydfdfAgency" class="form-control select-2" style="width: 100%" data-bind="options: AllTransformerList, optionsText: 'TransformerName',optionValue: 'TransformerID', value: AllSelectedTransformers,   valueUpdate:'change',optionsCaption: 'Choose', event:{'change': bindAllFeeders}"></select>
                  
                      </div>   

                  
                  
                </div> 

                <hr />
                 
                <div class="table-responsive">
                    <label for="exampleFormControlInput1"><b>Feeders</b></label>
                    <table id="data-tables" class="table  table-bordered" style="width:100%">
                        <thead>
                            <tr>
                                <th>S/N</th>
                                <th>Feeder Name</th>
                                <th>Feeder Volt Level</th>
                                <th>Panel CTR</th>
                                <th>MeterNo</th>
                                <th>Reading</th> 
                            </tr>
                        </thead>
                        <tbody>
                            <!-- ko foreach: AllDataList() -->   
                            <tr> 
                                <td><span data-bind="text:$index()+1"></span></td>
                                <td><span data-bind="text:FeederName"></span></td>
                                <td>33KV</td>
                                <td>600/1A</td>
                                <td><span data-bind="text:MeterNo"></span></td>
                                <td><input type="text" style="border:none" class="form-control" data-bind="value:ReadingValue, valueUpdate :'keyup',event: { 'keyup': $parent.AddToTheList } " /></td> 
                            </tr> 
                            <!-- /ko -->
                        </tbody>
                    </table>
                </div> 

                @*<div class="form-group">
                    <label for="exampleFormControlTextarea1">Comments</label>
                    <textarea class="form-control" id="exampleFormControlTextarea1" rows="2" data-bind="text:Comments"></textarea>
                </div>*@

                <hr />

                <div style="float:right" > 
                    <a href="#" class="btn btn-danger" data-toggle="tooltip" data-bind="click:CancelEnergy " data-original-title="Edit"> Clear  </a> 
                    <a href="#" class="btn btn-success" data-toggle="tooltip" data-bind="click:CreateEnergy " data-original-title="Edit"> Submit Readings</a> 
                </div> 
            </form>
        </div>
         
        <hr />


        <div class="card-header">
            <div class="table-responsive">
                <label for="exampleFormControlInput1"><b>Summary Usage by Month</b></label>
                <table id="data-tabled" class="table table-striped table-bordered" style="width:100%">


                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Position</th>
                            <th>Office</th>
                            <th>Age</th>
                            <th>Start date</th>
                            <th>Salary</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Tiger Nixon</td>
                            <td>System Architect</td>
                            <td>Edinburgh</td>
                            <td>61</td>
                            <td>2011/04/25</td>
                            <td>$320,800</td>
                        </tr>

                        <tr>
                            <td>Garrett Winters</td>
                            <td>Accountant</td>
                            <td>Tokyo</td>
                            <td>63</td>
                            <td>2011/07/25</td>
                            <td>$170,750</td>
                        </tr>

                        <tr>
                            <td>Ashton Cox</td>
                            <td>Junior Technical Author</td>
                            <td>San Francisco</td>
                            <td>66</td>
                            <td>2009/01/12</td>
                            <td>$86,000</td>
                        </tr>

                        <tr>
                            <td>Ashton Cox</td>
                            <td>Junior Technical Author</td>
                            <td>San Francisco</td>
                            <td>66</td>
                            <td>2009/01/12</td>
                            <td>$86,000</td>
                        </tr>

                        <tr>
                            <td>Ashton Cox</td>
                            <td>Junior Technical Author</td>
                            <td>San Francisco</td>
                            <td>66</td>
                            <td>2009/01/12</td>
                            <td>$86,000</td>
                        </tr>

                        <tr>
                            <td>Ashton Cox</td>
                            <td>Junior Technical Author</td>
                            <td>San Francisco</td>
                            <td>66</td>
                            <td>2009/01/12</td>
                            <td>$86,000</td>
                        </tr>

                        <tr>
                            <td>Ashton Cox</td>
                            <td>Junior Technical Author</td>
                            <td>San Francisco</td>
                            <td>66</td>
                            <td>2009/01/12</td>
                            <td>$86,000</td>
                        </tr>

                        <tr>
                            <td>Ashton Cox</td>
                            <td>Junior Technical Author</td>
                            <td>San Francisco</td>
                            <td>66</td>
                            <td>2009/01/12</td>
                            <td>$86,000</td>
                        </tr>

                        <tr>
                            <td>Ashton Cox</td>
                            <td>Junior Technical Author</td>
                            <td>San Francisco</td>
                            <td>66</td>
                            <td>2009/01/12</td>
                            <td>$86,000</td>
                        </tr>

                    </tbody>
                    <tfoot>
                        <tr>
                            <th>Name</th>
                            <th>Position</th>
                            <th>Office</th>
                            <th>Age</th>
                            <th>Start date</th>
                            <th>Salary</th>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
        <div class="card-body">
            <form>
                <div class="form-group">
                    <label for="exampleFormControlFile1">Example file input</label>
                    <input type="file" class="form-control-file" id="exampleFormControlFile1">
                </div>
            </form>
        </div>
    </div>
    </div>

<script src="~/Scripts/jquery-1.10.2.js"></script>
<script src="~/Scripts/knockout-3.4.0.debug.js"></script>
<script src="~/Scripts/knockout-3.4.0.js"></script>
<script src="~/Scripts/KnockOutMapping.js"></script>
<script src="~/Scripts/PHEDServe/PHEDServe.js"></script>

<script type="text/javascript">

    $(document).ready(function () {

        var EnergyManagementVM;
        $.ajax({
            url: '/GridEnergy/loadReferenceViewModel',
            type: 'GET',
            dataType: 'JSON',
            success: function (result) {
                var data = JSON.parse(result);
                console.log("Data From Server " + JSON.stringify(data));
                EnergyManagementVM = new PHEDServeEnergyViewModel(data);
                //ERPSearchData = data.CurrencyList;
                ko.applyBindings(EnergyManagementVM);
            },
            error: function (result) {
                alert("Failed" + result.responseText);
            }
        });


    });




</script>

<script>
    ko.bindingHandlers.date = {
        // https://disqus.com/home/discussion/jasonmitchellcom/binding_and_formatting_dates_using_knockout_and_moment_js/#comment-1374417079
        init: function (element, valueAccessor, allBindingsAccessor, viewModel) {
            ko.utils.registerEventHandler(element, 'change', function () {
                var value = valueAccessor();
                if (element.value !== null && element.value !== undefined && element.value.length > 0) {
                    value(element.value);
                }
                else {
                    value('');
                }
            });
        },
        update: function (element, valueAccessor, allBindingsAccessor, viewModel) {
            var value = valueAccessor();
            var allBindings = allBindingsAccessor();
            var valueUnwrapped = ko.utils.unwrapObservable(value);

            // Date formats: http://momentjs.com/docs/#/displaying/format/
            var pattern = allBindings.format || 'DD/MM/YYYY';

            var output = "-";
            if (valueUnwrapped !== null && valueUnwrapped !== undefined && valueUnwrapped.length > 0) {
                output = moment(valueUnwrapped).format(pattern);
            }

            if ($(element).is("input") === true) {
                $(element).val(output);
            } else {
                $(element).text(output);
            }
        }
    };
</script>