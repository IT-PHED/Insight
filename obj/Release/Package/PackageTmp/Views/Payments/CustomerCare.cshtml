
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_PHEDServeLayoutPage.cshtml";
}

<link type="text/css" href="~/assets/css/themes/default/vendor-bootstrap-datatables.css" rel="stylesheet">

<link href="~/Scripts/sweetalert2-master/dist/sweetalert.css" rel="stylesheet" />
<script src="~/Scripts/sweetalert2-master/dist/sweetalert.js"></script>
<div class="mdk-drawer-layout js-mdk-drawer-layout" data-fullbleed data-push data-has-scrolling-region>
    @*<div class="mdk-drawer-layout__content mdk-header-layout__content--scrollable">*@
    <!-- CONTENT BODY -->
    @*<div class="container-fluid">*@
    @*<h2>Tables</h2>*@
    <p class="lead">
        <b> Port-Harcourt Electricity Distribution Company</b>
    </p>
    <hr>
    
    <div class="card">
        <div class="card-header">
            <h4 class="card-title">
               PHED Customer Payment Data
            </h4>

            <hr />

            <div class="row">
                <div class="col-md-6 form-group">
         
                    <label class="custom-control custom-control-primary custom-radio">
                        <input class="custom-control-input" type="radio" name="message" data-bind="checked:SelectIfManualOrAutomatic, click:click" value="manual" checked="checked">
                        <span class="custom-control-indicator"></span>
                        <span class="custom-control-label">View by Date</span>
                    </label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    <label class="custom-control custom-control-primary custom-radio">
                        <input class="custom-control-input" type="radio" name="message" value="Automatic" data-bind="checked:SelectIfManualOrAutomatic, click:click">
                        <span class="custom-control-indicator"></span>
                        <span class="custom-control-label">View By Customer Number</span>
                    </label> 
                </div>
            </div>

         
            <div class="row" data-bind="visible:showAutomatic">
                <div class="col-md-6">
                    <label><b>Enter Customer Meter/Account Number/TransactionId</b></label>
                    <br />
                    <input type="text" data-bind="value:MeterNo" class="form-control" />
                </div>




                <div class="col-md-3">
                    <label><b>Status</b></label>
                    <br />
                    <select class="form-control" data-bind="value:StatusOptions">
                        <option>-Select--</option>
                        <option>ALL</option>
                        <option>SUCCESS</option>
                        <option>FAILED</option>
                        <option>NO TOKEN</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label><b>.</b></label>
                    <input type="button" style="background-color:green" data-bind="click:GetAllPaymentDataByMeterNo" class="btn form-control btn-success" value="View Details" />

                </div>
            </div>

           

         
     
            <div class="row" data-bind="visible:showAutomatic2">
                <div class="col-md-3">
                    <label><b>Select From Date</b></label>
                    <br />
                    <input type="date" class="form-control" />
                </div>

                <div class="col-md-3">
                    <label><b>Select To Date</b></label>
                    <br />
                    <input type="date" class="form-control" />
                </div>

                <div class="col-md-3">
                    <label><b>Meter Type</b></label>
                    <br />
                    <select class="form-control">
                        <option>-Select--</option>
                        <option>ALL</option>
                        <option>PREPAID</option>
                        <option>POSTPAID</option>

                    </select>
                </div>
                <div class="col-md-3">
                    <label><b>.</b></label>
                    <input type="button" style="background-color:green" class="btn form-control btn-success" value="View Report" />

                </div>
            </div>
       
        
        
         </div>
    

        <div class="py-4">
            <div class="table-responsive">
                <table id="TableGrid" class="table table-striped table-bordered" style="width:100%">
                    <thead>
                        <tr>
                            <th>S/No</th>
                          
                            <th>Type</th><th>AccountNo</th>
                            <th>Trans. ID</th>
                            <th>Amount</th>
                            <th>Trans. Date</th>
                            <th>Status</th>
                            <th>Token</th>

                            <th>Requery</th>
                        </tr>
                    </thead>



                    <tbody>
                        <!-- ko foreach: PaymentList1() -->
                        <tr>
                            <td><span data-bind="text:$index() +1"></span></td>
                            <td><span data-bind="text:AccountType"></span></td>

                            <!--ko if: AccountType() == "PREPAID"-->
                            <td><span data-bind="text:AlternateCustReference"></span></td>
                            <!--/ko-->
                            <!--ko if: AccountType() == "POSTPAID"-->
                            <td><span data-bind="text:CustomerReference"></span></td>
                            <!--/ko-->

                            <td>  <span data-bind="text:TransactionID"></span></td>
                            <td><span data-bind="text:Amount"></span> </td>
                            <td> <span data-bind="date:TransactionProcessDate"></span> </td>
                            <td> <span data-bind="text:PaymentStatus"></span>   </td>
                            <td> <span data-bind="text:Token"></span> </td>

                            <!-- ko if: Token() === "NOTAVAILABLE" -->
                            <td><button class="btn btn-xs btn-danger" data-bind="click:function() { $root.RequeryTransaction(TransactionID()) }  ">REQUERY</button></td>
                            <!-- /ko -->


                            <!-- ko if: Token() === "FAILED" -->
                            @*<td><button class="btn btn-xs btn-success">Success</button></td>*@
                            <td><button class="btn btn-xs btn-gray">REFUND</button></td> 
                            <!-- /ko -->


                            <!-- ko if: Token() !== "FAILED" && Token() !== "NOTAVAILABLE" -->
                            @*<td><button class="btn btn-xs btn-success">Success</button></td>*@
                            <td><button class="btn btn-xs btn-success" >SUCCESS</button></td>

                            <!-- /ko -->
                        </tr>
                        <!-- /ko -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    @*</div>*@
    @*</div>*@
    <!-- drawer -->

</div>

<script src="~/Scripts/jquery-1.10.2.js"></script>
<script src="~/Scripts/knockout-3.4.0.debug.js"></script>
<script src="~/Scripts/knockout-3.4.0.js"></script>
<script src="~/Scripts/KnockOutMapping.js"></script> 
<script src="~/Scripts/PHEDServe/PHEDServe.js"></script>

<script type="text/javascript">

    $(document).ready(function () {
        var AllTaxPayersViewModel;
        $.ajax({
            url: '/Payments/BindCustomers',
            type: 'GET',
            dataType: 'JSON',
            success: function (result) {
                var data = JSON.parse(result);
                console.log("Data From Server " + JSON.stringify(data));
                AllTaxPayersViewModel = new PHEDServeEnergyViewModel(data);
                ko.applyBindings(AllTaxPayersViewModel); 
                //apply the Datatable here
                //$("#TableGrid").dataTable();

            },
            error: function (result) {
                alert("Failed" + result.responseText);
            }
        });
    });


</script>

<script>
    ko.bindingHandlers.date = {
        // https://disqus.com/home/discussion/jasonmitchellcom/binding_and_formatting_dates_using_knockout_and_moment_js/#comment-1374417079
        init: function (element, valueAccessor, allBindingsAccessor, viewModel) {
            ko.utils.registerEventHandler(element, 'change', function () {
                var value = valueAccessor();
                if (element.value !== null && element.value !== undefined && element.value.length > 0) {
                    value(element.value);
                }
                else {
                    value('');
                }
            });
        },
        update: function (element, valueAccessor, allBindingsAccessor, viewModel) {
            var value = valueAccessor();
            var allBindings = allBindingsAccessor();
            var valueUnwrapped = ko.utils.unwrapObservable(value);

            // Date formats: http://momentjs.com/docs/#/displaying/format/
            var pattern = allBindings.format || 'DD/MM/YYYY';

            var output = "-";
            if (valueUnwrapped !== null && valueUnwrapped !== undefined && valueUnwrapped.length > 0) {
                output = moment(valueUnwrapped).format(pattern);
            }

            if ($(element).is("input") === true) {
                $(element).val(output);
            } else {
                $(element).text(output);
            }
        }
    };
</script>



