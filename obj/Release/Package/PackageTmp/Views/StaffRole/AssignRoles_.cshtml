
@{
    ViewBag.Title = "Roles ";
    Layout = "~/Views/Shared/_PHEDServeLayoutPage.cshtml";
}

<!DOCTYPE html>

<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>@ViewBag.Title - Assign Roles to Staff</title>
    <!-- Global stylesheets -->
    <link rel="stylesheet" href="~/Content/css/bootstrap.css" type="text/css" />
    <link rel="stylesheet" href="~/Content/css/animate.css" type="text/css" />
    <link rel="stylesheet" href="~/Content/css/font-awesome.min.css" type="text/css" />
    <link rel="stylesheet" href="~/Content/css/font.css" type="text/css" />
    <link rel="stylesheet" href="~/Content/js/calendar/bootstrap_calendar.css" type="text/css" />
    <link rel="stylesheet" href="~/Content/css/app.css" type="text/css" />
    <!-- /theme JS files -->

    <link href="~/Scripts/sweetalert2-master/dist/sweetalert.css" rel="stylesheet" />
    <script src="~/Scripts/sweetalert2-master/dist/sweetalert.js"></script>
</head>
<body>
    <input type="hidden" id="StaffId"  />
    <div class="card">
        <div class="card-header">
            <h4 class="card-title">Assign Roles</h4>
        </div>
        <div class="card-body">
            <div class="panel registration-form">
                <div class="panel-body">

                    
                    <!-- Page container -->
                    <div class="page-container">
                        <!-- Page content -->
                        <!-- Main content -->
                        <div class="content-wrapper">

                            <div class="content">


                                <!-- /initialization options -->
                                <!-- Selectable nodes -->

                                <div class="row">

                                    <div class="col-md-8 offset-md-2">
                                        <!-- Tree checkbox options -->
                                        <div class="panel panel-flat">
                                            @*<div class="panel-heading">
                                                <h6 class="panel-title">@ViewBag.Title - Assign Roles to Staff</h6>
                                                
                                            </div>*@

                                            <div class="panel-body">
                                                @*<p class="mb-15">You can turn off a node selection by adding <code>.hideCheckbox</code> class to it or disable it using <code>.unselectable</code> class.</p>*@

                                               

                                                <label>Search Staff</label>
                                                @*<select name="staff" id="staff" class="form-control" style="width: 100%" data-bind="options: usersList,optionsText: 'StaffName',optionValue: 'Id', value: selectedStaff, enable: !isProcessing(), valueUpdate:'change',event:{'change':selectUserRole},optionsCaption: 'Select Staff'"></select>*@

                                                <div class="input-group">
                                                    <input type="text" id="SearchItem" class="form-control searchly2" onkeyup="SearchAccountNo()" data-bind="  value: selectedStaff, enable: !isProcessing(), valueUpdate:'change',optionsCaption: 'Select Staff'" placeholder="Search by StaffID or Staff Email  ">
                                                    <div class="input-group-append">
                                                        <button class="btn btn-outline-primary" data-bind="click:selectUserRole2" type="button">View Role</button>
                                                    </div>
                                                </div>
                                                <br />
                                                <div class="well border-left-danger border-left-lg">







                                                    <ul data-bind="template: { name: 'itemTmpl', foreach: $data.items }"></ul>

                                                    <script id="itemTmpl" type="text/html">
                                                        <li class="folder">
                                                            <span data-bind="text: name" style="font-size:16px"></span>
                                                            <input type='checkbox' data-bind="checked: checked" />
                                                            <ul data-bind="template: { name: 'itemTmpl', foreach: $data.items }"></ul>
                                                        </li>
                                                    </script>

                                                </div>

                                                <hr />

                                                <div class="form-group" style="text-align:center">
                                                    <input type="submit" class="btn btn-primary" value="Assign Selected Role" data-bind="click: assignAndUnAssignRole" />
                                                </div>
                                            </div>
                                        </div>
                                        <!-- /tree checkbox options -->


                                    </div>



                                </div>


                            </div>
                            <!-- /content area -->
                        </div>
                        <!-- /main content -->

                    </div>
                    <!-- /page container -->


 







                    </div>
                </div>
            </div>
        </div>


                    <script src="~/Scripts/jquery-1.10.2.js"></script>
                    <script src="~/Scripts/moment.js"></script>
                    <script src="~/Scripts/knockout-3.4.0.debug.js"></script>
                    <script src="~/Scripts/knockout-3.4.0.js"></script>
                    <script src="~/Scripts/knockout-postbox.min.js"></script>
                    <script src="~/Scripts/KnockOutMapping.js"></script>

                    <script src="~/Scripts/StaffRole.js"></script>


    <link href="~/Scripts/jquery-ui-1.12.1.custom/jquery-ui.min.css" rel="stylesheet" />
    <script src="~/Scripts/jquery-ui-1.12.1.custom/jquery-ui.min.js"></script> 

    <script>
                        $(document).ready(function () {
                            var dataForTreeView = {};
                            var staffRoleViewModel;
                            showloader();
                            $.ajax({
                                url: '/StaffRole/loadstaffRoleViewModel',
                                type: 'GET',
                                dataType: 'JSON',
                                data:{
                                    Category:null
                                },
                                success: function (result) {
                                    var data = JSON.parse(result);

                                    console.log("Data From Server " + JSON.stringify(data));


                                    var getAllMenuHeaders = ko.utils.arrayFilter(data.modulesList, function (modulelist) {
                                        return modulelist.ControllerName == null;
                                    });

                                    var MainnewItems = [];

                                    ko.utils.arrayForEach(getAllMenuHeaders, function (moduleItem) {
                                        var newItems = [];

                                        var getAllSubItems = ko.utils.arrayFilter(data.modulesList, function (modulesublist) {
                                            return modulesublist.ParentMenuItemId == moduleItem.MenuItemId;
                                        });

                                        ko.utils.arrayForEach(getAllSubItems, function (subItem) {
                                            newItems.push({ "name": subItem.MenuText, "MenuItemId": subItem.MenuItemId, "checked": false })
                                        });

                                        MainnewItems.push({ "name": moduleItem.MenuText, "items": newItems })
                                        //item.checked(checked);
                                    });

                                    // console.log("Main menu  " + JSON.stringify(MainnewItems));

                                    //dataForTreeView = {
                                    //    items: MainnewItems,
                                    //    modulesActivityList: data.modulesActivityList,
                                    //    usersList: data.usersList,
                                    //    allStaffRoleList: data.allStaffRoleList,
                                    //    modulesList: data.modulesList,
                                    //    modulesHeadList: data.modulesHeadList,
                                    //    staffModulesActivityList: data.staffModulesActivityList
                                    //}

                                    dataForTreeView = {
                                        items: MainnewItems,

                                        usersList: data.usersList,
                                        allStaffRoleList: data.allStaffRoleList,
                                        modulesList: data.modulesList,
                                        modulesHeadList: data.modulesHeadList,
                                        staffModulesActivityList: data.staffModulesActivityList
                                    }
                                    console.log("Main menu extended " + JSON.stringify(MainnewItems));
                                    var model = new MyApp.TreeViewModel(dataForTreeView);
                                    ko.applyBindings(model);
                                    // model.usersList(data.usersList);
                                    // model.allStaffRoleList(data.allStaffRoleList);
                                    // model.modulesList(data.modulesList);
                                    //model.modulesHeadList(data.modulesHeadList);
                                    // model.modulesActivityList(new moduleListVW(data.modulesActivityList));
                                    //model.staffModulesActivityList(data.staffModulesActivityList);


                                    //[{ "name": "CREATE",
                                    //    "items": [{
                                    //        "name": "5 Day",
                                    //        "items": []
                                    //    }, {
                                    //        "name": "4 Day",
                                    //        "items": []
                                    //    }, {
                                    //        "name": "1/2 Day",
                                    //        "items": []
                                    //    }]}]


                                    //staffRoleViewModel = new LandTitleViewModel(data);

                                    // console.log("Data From Server Land Title" + JSON.stringify(landTitleCheckViewModel));
                                    //landTitleCheckViewModel.isProcessing(false);
                                    //ko.applyBindings(landTitleCheckViewModel);

                                    //$("#ContinentPage").DataTable({ responsive: true });
                                    hideloader();
                                },
                                error: function (result) {
                                    //left for brevity
                                    hideloader();
                                  console.log("Failed" + result.responseText);
                                }
                            });

                        });
                    </script>

    <script>
         
      //  u.StaffId, u.StaffName, u.Email, u.UserName
        function SearchAccountNo() {
            $(".searchly2").autocomplete({
                minLength: 2,
                source: function (request, response) {
                    $.ajax({
                        url: "@Url.Action("SearchStaff")",
                        data: { searchText: request.term },
                    dataType: "JSON",
                    type: "GET",
                    success: function (data) {
                        response($.map(data, function (obj) {
                            return { 
                                label: obj.StaffId + ' - ' + obj.StaffName + ' - ' + obj.Email,
                                StaffName: obj.StaffName,
                                StaffId: obj.StaffId,
                                UserName: obj.UserName,
                                Email: obj.Email,
                                Id: obj.Id
                                 
                            };
                        }));
                    }
                });
        },
        select: function(event, ui) {
         

            $("#StaffId").val(ui.item.Id);
            $("#SearchItem").val(ui.item.label);
                              
            return false;
        }
        }).data("autocomplete")._renderItem = function (ul, item) {
            // Inside of _renderItem you can use any property that exists on each item that we built
            // with $.map above */

            return $("<li></li>")
                .data("item.autocomplete", item)
                .append("<a>" + item.StaffName + "</a>")
                .append("<a>" + item.StaffId + "</a>")
                .appendTo(ul);
        }
        }

        function hideloader() {

            swal.close();
        }
        function showloader() {
            swal({
                title: "Loading...",
                text: "Please wait",
                imageUrl: 'http://phedpayments.nepamsonline.com/images/loader4.gif',

                showConfirmButton: false,
                allowOutsideClick: false
            });


        };
    </script>

   
</body>
</html>
